"use strict";
[{ "@solana/web3.js';\n\n/**\n * ClawDB Anchor Program Interface\n * \n * This file provides the interface for interacting with the deployed ClawDB program\n * on Solana devnet.\n */\n\nexport const CLAWDB_PROGRAM_ID = new PublicKey('clawdb1111111111111111111111111111111111111111');\n\n/**\n * ClawDB Program Accounts\n */\nexport const CLAWDB_CONFIG = new PublicKey('config1111111111111111111111111111111111111": "export interface ClawDBInstructions {\n  initialize?: { authority: PublicKey" }, { "authority": "PublicKey;\n    asset: PublicKey;\n    payer: PublicKey;\n    metadataHash: string;\n    dataCid: string;\n    pricingType: 'PerQuery' | 'Subscription';\n    price: number;" }, { "authority": "PublicKey;\n    asset: PublicKey;\n    newMetadataHash: string;\n    newDataCid?: string;\n    newPricingType?: 'PerQuery' | 'Subscription';\n    newPrice?: number;" }, { "asset": "PublicKey;\n    purchaser: Keypair;\n    payment: PublicKey;\n    treasury: PublicKey;\n    amount: number;" }, { "asset": "PublicKey;\n    rater: Keypair;\n    rating: number;" }, { "authority": "Keypair;\n    asset: PublicKey;" }, { "from": "authority.publicKey", "newAccount": "CLAWDB_CONFIG", "space": 100 }, ["authority]);\n  \n  return signature;\n}\n\n/**\n * Create a data asset on-chain\n */\nexport async function createDataAsset(\n  connection: Connection,\n  authority: Keypair,\n  asset: PublicKey,\n  payer: Keypair,\n  metadataHash: string,\n  dataCid: string,\n  pricingType: 'PerQuery' | 'Subscription' = 'PerQuery',\n  price: number = 1000, // in lamports\n  secret: Keypair\n): Promise<string> {\n  const instructions = await getCreateAssetInstructions(\n    connection,\n    authority,\n    asset,\n    payer,\n    metadataHash,\n    dataCid,\n    pricingType,\n    price,\n  );\n\n  const transaction = new Transaction().add(...instructions);\n  \n  const signature = await connection.sendTransaction(transaction, [payer, secret]);\n  \n  return signature;\n}\n\n/**\n * Get instructions for creating an asset\n */\nasync function getCreateAssetInstructions(\n  connection: connection,\n  authority: Keypair,\n  asset: PublicKey,\n  payer: Keypair,\n  metadataHash: string,\n  dataCid: string,\n  pricingType: 'PerQuery' | 'Subscription',\n  price: number,\n): Promise<TransactionInstruction[]> {\n  const dataBuffer = Buffer.concat(\n    Buffer.from(metadataHash),\n    Buffer.from(dataCid),\n    Buffer.from([pricingType === 'PerQuery' ? 0 : 1]),\n    Buffer.from(BigUint64Array.from(BigUint64.from(price).buffer)),\n    Buffer.from(authority.publicKey.toBuffer()),\n  );\n\n  const assetSpace = 8 + 32 + 32 + 32 + 1 + 200 + 200 + 1 + 4 + 1;\n\n  return [\n    SystemProgram.createAccount({\n      from: payer.publicKey,\n      newAccount: asset,\n      space: assetSpace,\n    }),\n  ];\n}\n\n/**\n * Purchase access to a data asset\n */\nexport async function purchaseAccess(\n  connection: Connection,\n  asset: PublicKey,\n  purchaser: Keypair,\n  paymentAccount: PublicKey,\n  treasury: PublicKey,\n  amount: number,\n  secret: Keypair\n): Promise<string> {\n  const instructions = [\n    SystemProgram.transfer({\n      from: paymentAccount,\n      to: asset,\n      lamports: amount,\n    }),\n  ];\n\n  const transaction = new Transaction().add(...instructions);\n  \n  const signature = await connection.sendTransaction(transaction, [purchaser, secret]);\n  \n  return signature;\n}\n\n/**\n * Rate a data asset\n */\nexport async function rateAsset(\n  connection: Connection,\n  asset: PublicKey,\n  rater: Keypair,\n  rating: number,\n  ratingFeeAccount: PublicKey,\n  assetAccount: PublicKey,\n  secret: Keypair\n): Promise<string> {\n  const instructions = [\n    SystemProgram.transfer({\n      from: rater.publicKey,\n      to: assetAccount,\n      lamports: 1000, // 0.000001 SOL rating fee\n    }),\n  ];\n\n  const transaction = new Transaction().add(...instructions);\n  \n  const signature = await connection.sendTransaction(transaction, [rater, secret]);\n  \n  return signature;\n}\n\n/**\n * Derive the asset account address from seed\n */\nexport function deriveAssetAddress(\n  authority: PublicKey,\n  seed: string\n): PublicKey {\n  return PublicKey.findProgramAddress(\n    [CLAWDB_PROGRAM_ID],\n    [authority, Buffer.from(seed)],\n  );\n}\n\n/**\n * Derive the treasury address\n */\nexport function deriveTreasuryAddress(): PublicKey {\n  return PublicKey.findProgramAddress(\n    [CLAWDB_PROGRAM_ID],\n    ['treasury'],\n  );\n}\n\n/**\n * Get the asset account data\n */\nexport async function getAssetData(connection: Connection, asset: PublicKey): Promise<any> {\n  const accountInfo = await connection.getAccountInfo(asset);\n  return accountInfo.data;\n}\n\n/**\n * Create a ClawDB config account (for local dev)\n */\nexport function createConfigAccount(): Keypair {\n  return Keypair.generate();\n}\n\n/**\n * Create a treasury account\n */\nexport function createTreasuryAccount(): Keypair {\n  return Keypair.generate();\n}\n\n/**\n * Create a placeholder asset account (for testing)\n */\nexport function createAssetAccount(): Keypair {\n  return Keypair.generate();\n}\n\n/**\n * Helper: Generate metadata hash\n */\nexport function generateMetadataHash(metadata: any): string {\n  const data = JSON.stringify(metadata);\n  const crypto = require('crypto');\n  return crypto.createHash('sha256').update(data).digest('hex');\n}\n\n/**\n * Helper: Generate seed for PDA\n */\nexport function generateAssetSeed(index: number): string {\n  return `asset-${index}`;\n}\n\n/**\n * Check if devnet is healthy\n */\nexport async function checkDevnetHealth(): Promise<boolean> {\n  try {\n    const connection = new Connection('https://api.devnet.solana.com');\n    const slot = await connection.getSlot();\n    return slot > 0;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get current devnet balance\n */\nexport async function getDevnetBalance(wallet: PublicKey): Promise<number> {\n  const connection = new Connection('https://api.devnet.solana.com');\n  const balance = await connection.getBalance(wallet);\n  return balance;\n}"]];
